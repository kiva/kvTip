/**
 * kvTip - v0.6.0 
 * Copyright (c) 2013 Kiva Microfunds
 * 
 * Licensed under the MIT license.
 * https://github.com/kiva/backbone.siren/blob/master/license.txt
 */
define(["jquery"],function(a){function b(b,c){var d=a.extend(this,c);this._timer="",this._id=e++,this.$el=b,this.width=d.width||"",this.height=d.height||"",this.options=d,"a"==b[0].nodeName.toLowerCase()&&d.preventDefault&&b.click(function(a){a.preventDefault()}),this.initBindings(),b.data("kvTip",{tipID:this.id()})}function c(b){var c=a(window),d=a(document),e=b.offset().top,f=b.offset().left,g=d.scrollTop(),h=d.scrollLeft();return!(g>e||h>f||e+b.innerHeight()>g+c.height()||f+b.innerWidth()>h+c.width())}function d(a){return"undefined"!=typeof a}var e=0;return a.fn.kvTip=function(c){if(this.length){"string"==typeof c&&(c={content:c});var d=b.defaults.className,e=a.extend(!0,{},b.defaults,c);return e.className+=" "+d,this.each(function(){new b(a(this),e)})}},b.prototype={showTip:function(){var a=this.$tip,b=this.options;a.hasClass("active")||a.css({display:"none",visibility:"visible"}).addClass("active").fadeIn(400,function(){"function"==typeof b.onshow&&b.onshow.apply(a)})},hideOnTimeout:function(){var a=this.$tip,b=this,c=this.options;d(a)&&a.length&&(this._timer=setTimeout(function(){b.hide()},c.hideDelay))},hide:function(){var a=this.$el,b=this,c=this.$tip,d=this.options;a.attr("title",b.elTitle||""),c.fadeOut("fast","linear",function(){"function"==typeof d.onhide&&b.onhide(this)}).removeClass("active")},position:function(){var b=a.extend({},$el.offset(),{width:$el[0].offsetWidth,height:$el[0].offsetHeight}),c=($tip[0].offsetWidth,$tip[0].offsetHeight),d={"z-index":zIndex+1,top:b.top+b.height/2-c/2,left:b.left+b.width};this.$tip.css(d)},getTip:function(){var b,c=this.$el,d=this,e=this.options,f=a('<div id="'+d.id()+'" class="'+this.className+'" />');e.title&&f.html('<div class="kvTipTitle">'+e.title+"</div>"),b=c.css("z-index"),c.parentsUntil("html").each(function(){var c=a(this).css("z-index");a.isNumeric(c)&&(!a.isNumeric(b)||c>b)&&(b=c)});var g=a.extend({},c.offset(),{width:c[0].offsetWidth,height:c[0].offsetHeight}),h=(f[0].offsetWidth,f[0].offsetHeight),i={"z-index":b+1,top:g.top+g.height/2-h/2,left:g.left+g.width};return f.css(i).append('<div class="kvTipContent"></div>').mouseenter(function(){self._resetTimer()}).mouseleave(function(){self.hide()}).addClass("loading").appendTo("body").click(function(){self.hide()}),this.$tip=f,f},getContent:function(b){var c=this.$el,d=this,e=this.options,f="";if(e.ajax&&!b){if(e.inlineUrl&&(e.ajax.url=c.attr(e.inlineUrl)),e.inlineData){var g={};g[e.inlineData]=c.attr(e.inlineData),e.ajax.data=a.extend(e.ajax.data,g)}return a.ajax(e.ajax)}return e.selector?f=a(e.selector).html():e.content?f=a.isFunction(e.content)?e.content():e.content:d.elTitle&&(f=d.elTitle),f},addContent:function(){var a,b=this.$tip,d=this,e=this.options,f=this.content;e.ajax?(a=b.clone(),a.removeClass("loading").attr("id",d.id()).css({width:d.width||"",height:d.height||""}).appendTo("body").find(".kvTipContent").html(f),a.offset({top:-9999,left:-9999}),d.width=d.width||a.width(),d.height=d.height||a.height(),a.offset(b.offset()),c(a)||(a.position(e.position),b.offset(a.offset())),b.animate({width:d.width,height:d.height},function(){b.removeClass("loading").find(".kvTipContent").html(f)}),a.remove()):b.removeClass("loading").css({width:d.width||"",height:d.height||""}).find(".kvTipContent").html(f).end().position(e.position)},id:function(){return"kvTip_"+this._id},_resetTimer:function(){clearTimeout(this._timer),delete this._timer},initBindings:function(){var b=this,c=this.$tip,d=this.$el,e=this.options;d.mouseenter(function(){b.elTitle=d.attr("title"),d.attr("title",""),c=a("#"+b.id()),b.ajax&&b.cache===!1&&(b.cache=!1),(!c.length||b.ajax&&b.ajax.cache===!1||b.cache===!1)&&((b.ajax&&b.ajax.cache===!1||b.cache===!1)&&c.remove(),c=b.getTip(),a.when(b.getContent()).done(function(a){"function"==typeof b.onload&&(a=b.onload.call(c,a)),a?(b.content=a,b.addContent()):c.remove()}).fail(function(){var a=b.getContent(!0);a?(b.content=a,b.addContent()):c.remove()}))}),e.showOnclick?d.click(function(a){a.preventDefault(),b.showTip()}).mouseenter(function(){b._resetTimer()}).mouseleave(function(){b.hide()}):d.hoverIntent(function(){b._resetTimer(),b.showTip()},function(){}).mouseleave(function(){b.hide()})}},b.defaults={title:"",content:"",selector:"",cache:!0,ajax:null,inlineUrl:"",inlineData:"",preventDefault:!0,className:"kvTip",position:"top-right",width:null,height:null,showOnClick:!1,hideOnClick:!1,hideOnDelay:300},aviso});